<div class="page-container">
  <div class="header-actions mb-3">
    <h1>Client Master</h1>
    <span class="spacer"></span>
    <button mat-raised-button color="primary" (click)="addNewClient()">
      <mat-icon>add</mat-icon> Add New Client
    </button>
  </div>

  <mat-card class="data-card">
    <mat-card-content>
      <!-- Filter & Actions Toolbar -->
      <div class="table-toolbar">
        <mat-form-field appearance="outline" class="filter-field">
          <mat-label>Filter Clients</mat-label>
          <mat-icon matPrefix>search</mat-icon>
          <input matInput (keyup)="applyFilter($event)" placeholder="Search by name, code, pan...">
        </mat-form-field>

        <span class="spacer"></span>

        <button mat-stroked-button color="warn" [disabled]="isButtonDisabled" (click)="openDeleteDialog()">
          <mat-icon>delete</mat-icon> Delete Selected
        </button>
      </div>

      <div class="table-container">
        <table mat-table [dataSource]="dataSource" matSort multiTemplateDataRows class="full-width-table">

          <!-- Checkbox Column -->
          <ng-container matColumnDef="select">
            <th mat-header-cell *matHeaderCellDef>
              <mat-checkbox (change)="$event ? masterToggle() : null"
                [checked]="selection.hasValue() && isAllSelected()"
                [indeterminate]="selection.hasValue() && !isAllSelected()" color="primary">
              </mat-checkbox>
            </th>
            <td mat-cell *matCellDef="let row">
              <mat-checkbox (click)="$event.stopPropagation()" (change)="toggleSelection(row)"
                [checked]="selection.isSelected(row)" color="primary">
              </mat-checkbox>
            </td>
          </ng-container>

          <!-- Client Code Column -->
          <ng-container matColumnDef="clientCode">
            <th mat-header-cell *matHeaderCellDef mat-sort-header> Client Code </th>
            <td mat-cell *matCellDef="let element">
              <span class="badge-code">{{element.clientCode}}</span>
            </td>
          </ng-container>

          <!-- Client Name Column -->
          <ng-container matColumnDef="clientName">
            <th mat-header-cell *matHeaderCellDef mat-sort-header> Name </th>
            <td mat-cell *matCellDef="let element">
              <strong>{{element.name}}</strong>
              <div class="text-caption text-secondary">{{element.clientEmail}}</div>
            </td>
          </ng-container>

          <!-- Father Name Column -->
          <ng-container matColumnDef="fatherName">
            <th mat-header-cell *matHeaderCellDef> Father's Name </th>
            <td mat-cell *matCellDef="let element"> {{element.fatherName}} </td>
          </ng-container>

          <!-- PAN No Column -->
          <ng-container matColumnDef="panNo">
            <th mat-header-cell *matHeaderCellDef> PAN </th>
            <td mat-cell *matCellDef="let element"> {{element.pan}} </td>
          </ng-container>

          <!-- Client Type Column -->
          <ng-container matColumnDef="clientType">
            <th mat-header-cell *matHeaderCellDef> Type </th>
            <td mat-cell *matCellDef="let element"> {{element.clientType | titlecase}} </td>
          </ng-container>

          <!-- DOB/DOI Column -->
          <ng-container matColumnDef="doiOrDob">
            <th mat-header-cell *matHeaderCellDef> DOB/DOI </th>
            <td mat-cell *matCellDef="let element"> {{element.doiOrDob | date}} </td>
          </ng-container>

          <!-- Mobile Column -->
          <ng-container matColumnDef="mobile">
            <th mat-header-cell *matHeaderCellDef> Mobile </th>
            <td mat-cell *matCellDef="let element"> {{element.mobile}} </td>
          </ng-container>

          <!-- Actions Column -->
          <ng-container matColumnDef="actions">
            <th mat-header-cell *matHeaderCellDef> Actions </th>
            <td mat-cell *matCellDef="let element">
              <button mat-icon-button color="primary" matTooltip="Select Client"
                (click)="$event.stopPropagation(); openAssessmentYearDialog(element)">
                <mat-icon>check_circle_outline</mat-icon>
              </button>
              <button mat-icon-button color="accent" matTooltip="Edit Info"
                (click)="$event.stopPropagation(); openEditPage(element)">
                <mat-icon>edit</mat-icon>
              </button>
            </td>
          </ng-container>

          <!-- Expanded Content Column - The detail row is made up of this one column that spans across all columns -->
          <ng-container matColumnDef="expandedDetail">
            <td mat-cell *matCellDef="let element" [attr.colspan]="displayedColumns.length">
              <div class="example-element-detail"
                [@detailExpand]="element == expandedElement ? 'expanded' : 'collapsed'">
                <div class="expanded-detail-panel">
                  <div class="detail-grid">
                    <div class="detail-item" *ngFor="let item of childDataSource">
                      <span class="detail-label">{{item.heading}}</span>
                      <span class="detail-value">{{item.value}}</span>
                    </div>
                  </div>
                </div>
              </div>
            </td>
          </ng-container>

          <tr mat-header-row *matHeaderRowDef="displayedColumns; sticky: true"></tr>
          <tr mat-row *matRowDef="let element; columns: displayedColumns;" class="example-element-row"
            [class.example-expanded-row]="expandedElement === element"
            (click)="expandedElement = expandedElement === element ? null : element; changeChildDataSource(element)">
          </tr>
          <tr mat-row *matRowDef="let row; columns: ['expandedDetail']" class="example-detail-row"></tr>
        </table>

        <div class="loading-shade" *ngIf="isLoading">
          <mat-progress-spinner color="primary" mode="indeterminate"></mat-progress-spinner>
        </div>
      </div>

      <mat-paginator [pageSizeOptions]="[10, 20, 50]" showFirstLastButtons class="mat-elevation-z0"></mat-paginator>
    </mat-card-content>
  </mat-card>
</div>