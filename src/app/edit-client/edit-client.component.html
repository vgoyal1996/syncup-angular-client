<div class="page-container">

    <!-- Header Card -->
    <mat-card class="header-card">
        <mat-card-header>
            <mat-icon class="header-icon">edit</mat-icon>
            <div style="display: flex; flex-direction: column;">
                <mat-card-title>Edit Client</mat-card-title>
                <mat-card-subtitle>Update client details below</mat-card-subtitle>
            </div>
        </mat-card-header>
    </mat-card>

    <div class="scrollable-content">
        <div class="scrollable-content">
            <form [formGroup]="editClientForm" (ngSubmit)="updateClientInfo()">

                <!-- Basic Info Card -->
                <mat-card class="section-card">
                    <mat-card-content>
                        <div class="section-title">
                            <mat-icon>info</mat-icon> Basic Information
                        </div>
                        <div class="form-row">
                            <mat-form-field appearance="outline" class="half-width">
                                <mat-label>Client Name</mat-label>
                                <input matInput formControlName="clientName" placeholder="Ex. John Doe" required>
                                <mat-error *ngIf="clientName.invalid">Client Name is required</mat-error>
                            </mat-form-field>

                            <mat-form-field appearance="outline" class="half-width">
                                <mat-label>Client Code</mat-label>
                                <input matInput formControlName="clientCode" placeholder="Ex. JD001" required>
                                <mat-error *ngIf="clientCode.invalid">Client Code is required</mat-error>
                            </mat-form-field>

                            <mat-form-field appearance="outline" class="half-width">
                                <mat-label>Father's Name</mat-label>
                                <input matInput formControlName="fatherName" placeholder="Father's Name" required>
                                <mat-error *ngIf="fatherName.invalid">Father's Name is required</mat-error>
                            </mat-form-field>

                            <mat-form-field appearance="outline" class="half-width">
                                <mat-label>Client Type</mat-label>
                                <mat-select formControlName="clientType" required>
                                    <mat-option value="individual">Individual</mat-option>
                                    <mat-option value="company">Company</mat-option>
                                    <mat-option value="llp">LLP</mat-option>
                                    <mat-option value="huf">HUF</mat-option>
                                    <mat-option value="firm">Firm</mat-option>
                                    <mat-option value="association_of_persons">Association Of Persons</mat-option>
                                    <mat-option value="trust">Trust</mat-option>
                                    <mat-option value="body_of_individuals">Body Of Individuals</mat-option>
                                    <mat-option value="local_authority">Local Authority</mat-option>
                                    <mat-option value="artificial_juridical_person">Artificial Juridical
                                        Person</mat-option>
                                    <mat-option value="government">Government</mat-option>
                                </mat-select>
                                <mat-error *ngIf="clientType.invalid">Client Type is required</mat-error>
                            </mat-form-field>
                        </div>
                    </mat-card-content>
                </mat-card>

                <!-- Address Card -->
                <mat-card class="section-card">
                    <mat-card-content>
                        <div class="section-title">
                            <mat-icon>home</mat-icon> Address Details
                        </div>
                        <div class="form-row">
                            <mat-form-field appearance="outline" class="third-width">
                                <mat-label>Flat No.</mat-label>
                                <input matInput formControlName="flatNo" required>
                                <mat-error *ngIf="flatNo.invalid">Required</mat-error>
                            </mat-form-field>

                            <mat-form-field appearance="outline" class="third-width">
                                <mat-label>Area</mat-label>
                                <input matInput formControlName="area" required>
                                <mat-error *ngIf="area.invalid">Required</mat-error>
                            </mat-form-field>

                            <mat-form-field appearance="outline" class="third-width">
                                <mat-label>City</mat-label>
                                <input matInput formControlName="city" required>
                                <mat-error *ngIf="city.invalid">Required</mat-error>
                            </mat-form-field>

                            <mat-form-field appearance="outline" class="third-width">
                                <mat-label>State</mat-label>
                                <input type="text" placeholder="Pick one" matInput formControlName="state"
                                    [matAutocomplete]="auto">
                                <mat-autocomplete #auto="matAutocomplete" [displayWith]="displayFn.bind(this)">
                                    <mat-option *ngFor="let option of filteredStates | async" [value]="option.value">
                                        {{option.display}}
                                    </mat-option>
                                </mat-autocomplete>
                                <mat-error *ngIf="state.invalid">Required</mat-error>
                            </mat-form-field>

                            <mat-form-field appearance="outline" class="third-width">
                                <mat-label>PIN Code</mat-label>
                                <input matInput formControlName="pin" required>
                                <mat-error *ngIf="pin.invalid">Required</mat-error>
                            </mat-form-field>
                        </div>
                    </mat-card-content>
                </mat-card>

                <!-- Tax & Contact Card -->
                <mat-card class="section-card">
                    <mat-card-content>
                        <div class="section-title">
                            <mat-icon>receipt_long</mat-icon> Tax & Contact Info
                        </div>
                        <div class="form-row">
                            <mat-form-field appearance="outline" class="half-width">
                                <mat-label>Mobile No.</mat-label>
                                <input matInput formControlName="mobile" required>
                                <mat-error *ngIf="mobile.hasError('required')">Required</mat-error>
                                <mat-error *ngIf="mobile.hasError('pattern')">Must start with 6-9 and be 10
                                    digits</mat-error>
                            </mat-form-field>

                            <mat-form-field appearance="outline" class="half-width">
                                <mat-label>Email ID</mat-label>
                                <input matInput formControlName="emailId" required>
                                <mat-error *ngIf="emailId.hasError('required')">Required</mat-error>
                                <mat-error *ngIf="emailId.hasError('email')">Invalid email</mat-error>
                            </mat-form-field>

                            <mat-form-field appearance="outline" class="half-width">
                                <mat-label>PAN No.</mat-label>
                                <input matInput formControlName="pan" style="text-transform: uppercase" required>
                                <mat-error *ngIf="pan.invalid">Invalid PAN Format</mat-error>
                            </mat-form-field>

                            <mat-form-field appearance="outline" class="half-width">
                                <mat-label>DOI / DOB</mat-label>
                                <input matInput [matDatepicker]="picker" formControlName="dobOrDoi" required>
                                <mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>
                                <mat-datepicker #picker></mat-datepicker>
                                <mat-error *ngIf="dobOrDoi.invalid">Required</mat-error>
                            </mat-form-field>
                        </div>
                    </mat-card-content>
                </mat-card>

                <!-- Additional Info Card (Conditional) -->
                <mat-card class="section-card" *ngIf="clientType.value && clientType.value !== 'individual'">
                    <mat-card-content>
                        <div class="section-title">
                            <mat-icon>business</mat-icon> Responsible Person Details
                        </div>
                        <div class="form-row">
                            <mat-form-field appearance="outline" class="half-width">
                                <mat-label>Name</mat-label>
                                <input matInput formControlName="responsiblePersonName" required>
                                <mat-error *ngIf="responsiblePersonName.invalid">Required</mat-error>
                            </mat-form-field>

                            <mat-form-field appearance="outline" class="half-width">
                                <mat-label>PAN</mat-label>
                                <input matInput formControlName="responsiblePersonPan" style="text-transform: uppercase"
                                    required>
                                <mat-error *ngIf="responsiblePersonPan.invalid">Invalid PAN</mat-error>
                            </mat-form-field>

                            <mat-form-field appearance="outline" class="half-width">
                                <mat-label>DOB</mat-label>
                                <input matInput [matDatepicker]="rpPicker" formControlName="responsiblePersonDob"
                                    required>
                                <mat-datepicker-toggle matSuffix [for]="rpPicker"></mat-datepicker-toggle>
                                <mat-datepicker #rpPicker></mat-datepicker>
                                <mat-error *ngIf="responsiblePersonDob.invalid">Required</mat-error>
                            </mat-form-field>

                            <div class="full-width"
                                *ngIf="clientType.value === 'company' || clientType.value === 'llp'">
                                <mat-form-field appearance="outline" class="full-width">
                                    <mat-label>CIN No.</mat-label>
                                    <input matInput formControlName="cin" required>
                                    <mat-error *ngIf="cin.invalid">Invalid CIN Format</mat-error>
                                </mat-form-field>
                            </div>
                        </div>
                    </mat-card-content>
                </mat-card>

                <mat-card class="section-card" *ngIf="clientType.value === 'individual'">
                    <mat-card-content>
                        <div class="section-title">
                            <mat-icon>fingerprint</mat-icon> Additional Info
                        </div>
                        <div class="form-row">
                            <mat-form-field appearance="outline" class="full-width">
                                <mat-label>Aadhaar No.</mat-label>
                                <input matInput formControlName="responsiblePersonAadhaar" required>
                                <mat-error *ngIf="responsiblePersonAadhaar.invalid">Invalid Aadhaar (12 digits, no 0/1
                                    start)</mat-error>
                            </mat-form-field>
                        </div>
                    </mat-card-content>
                </mat-card>

                <div class="actions-row">
                    <button mat-raised-button color="primary" type="submit" [disabled]="editClientForm.invalid">
                        <mat-icon>save</mat-icon> Update Client
                    </button>
                    <button mat-button type="button" routerLink="/client-master">Cancel</button>
                </div>

            </form>
        </div>
    </div>